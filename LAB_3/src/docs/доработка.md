# 3.2 — Доработка ESLint + Prettier + Stylelint

## package.json — скрипты

- `"type-check": "tsc --noEmit"` — проверка TypeScript кода на ошибки без генерации файлов. Нужно, чтобы ESLint и Prettier проверяли корректный код TS.

- `"lint:js": "eslint src/**/*.{ts,tsx} --fix"` — запускает ESLint на всех TS/TSX файлах в `src`, автоматически исправляя ошибки там, где возможно (`--fix`).

- `"lint:css": "stylelint src/**/*.css --fix"` — проверяет CSS-файлы через Stylelint и автоматически исправляет ошибки форматирования и правила.

- `"lint": "npm run type-check && npm run lint:js && npm run lint:css"` — объединённый скрипт, который делает **проверку TS**, **линтинг JS/TS** и **линтинг CSS** одним запуском. Удобно запускать перед коммитом или CI.

## eslint.config.mjs

### Импорты плагинов и конфигов

- `import js from '@eslint/js'` — стандартные правила ESLint для JS (`eslint:recommended`). Обеспечивают базовую проверку синтаксиса JavaScript.

- `import typescriptPlugin from '@typescript-eslint/eslint-plugin'` — подключение расширенных правил для TypeScript. Проверяют TS-специфические ошибки, потенциальные баги и нарушения стиля.

- `import typescriptParser from '@typescript-eslint/parser'` — парсер, который умеет читать TypeScript и TSX. Без него ESLint не понимает синтаксис TS/TSX.

- `import globals from 'globals'` — позволяет ESLint знать о глобальных объектах, например `window`, `document`, `BigInt` и др., чтобы не выдавал ошибки на использование этих объектов.

- `import prettierConfig from 'eslint-config-prettier'` — отключает правила ESLint, которые могут конфликтовать с Prettier. Позволяет Prettier полностью контролировать стиль кода.

- `import pluginPrettier from 'eslint-plugin-prettier'` — интеграция Prettier в ESLint, чтобы ошибки форматирования показывались как ошибки ESLint (`prettier/prettier`).

- `import reactPlugin from 'eslint-plugin-react'` — правила для React: проверка JSX, компонентов, props, а также соблюдения React API.

- `import reactHooks from 'eslint-plugin-react-hooks'` — проверка правильного использования хуков: `useEffect`, `useState`, `useCallback`, чтобы избежать багов из-за неправильного порядка вызовов хуков.

### Основная конфигурация ESLint

- `js.configs.recommended` — базовые правила JavaScript. То, что было в старом конфиге, просто расширено под современный проект.

- `files: ['**/*.ts', '**/*.tsx']` — применяем расширенные правила только к TypeScript и TSX файлам, чтобы линтер не ругался на JS файлы или конфиги.

- `languageOptions.parser: typescriptParser` — используем TypeScript-парсер для корректной проверки синтаксиса TS и JSX.

- `globals: { ...globals.browser, ...globals.es2020 }` — добавляем глобальные объекты браузера (`window`, `document`) и ES2020 (`BigInt`, `Promise.allSettled`), чтобы ESLint не ругался на их использование.

- `parserOptions.ecmaFeatures.jsx: true` — включаем поддержку JSX для React, чтобы линтер понимал JSX-синтаксис.

- `plugins: { '@typescript-eslint': typescriptPlugin, prettier: pluginPrettier, react: reactPlugin, 'react-hooks': reactHooks }` — подключаем плагины для TypeScript, Prettier, React и хуков, чтобы линтер мог проверять TS, стиль кода и React-правила.

- `rules: { ...typescriptPlugin.configs.recommended.rules, 'prettier/prettier': 'error', 'react/react-in-jsx-scope': 'off', 'react/jsx-uses-react': 'off', 'react/jsx-uses-vars': 'error', 'react-hooks/rules-of-hooks': 'error', 'react-hooks/exhaustive-deps': 'warn' }` —
  наследуем стандартные правила TypeScript, добавляем ошибки для Prettier (`prettier/prettier`), отключаем устаревшие правила React для версии 17+ (`react/react-in-jsx-scope`, `react/jsx-uses-react`), проверяем JSX-переменные (`react/jsx-uses-vars`) и хуки (`react-hooks/rules-of-hooks`, `react-hooks/exhaustive-deps`).

- `settings.react.version: 'detect'` — ESLint автоматически определяет версию React и подстраивает правила под неё, чтобы корректно проверять JSX и хуки.

- `{ ignores: ['dist/', 'node_modules/', '*.config.js'] }` — игнорируем скомпилированные файлы, зависимости и конфиги, чтобы ESLint не проверял лишнее.

- `prettierConfig` — подключаем Prettier, чтобы ESLint не конфликтовал с правилами форматирования, уже обработанными Prettier.

## 3.3 Подключение плагинов React и React-Hooks

**Что сделано:**

- В `eslint.config.mjs` подключены плагины:
  - `reactPlugin` для правил React (`eslint-plugin-react`)
  - `reactHooks` для правил хуков (`eslint-plugin-react-hooks`)

- Включены правила:
  - `'react-hooks/rules-of-hooks': 'error'` — запрещает нарушать порядок вызова хуков
  - `'react-hooks/exhaustive-deps': 'warn'` — проверка зависимостей useEffect
  - `'react/jsx-uses-vars': 'error'` — предупреждает о неиспользуемых переменных в JSX

**Проверка работы:**

Создан файл `src/testhooks.tsx`, где намеренно нарушены правила:

- `useEffect` вызывается внутри `if` — нарушение правил хуков.
- Переменная `unusedVar` не используется в JSX — нарушение правила `jsx-uses-vars`.

Запуск `npm run lint` показал ошибки:

8:5 error React Hook "useEffect" is called conditionally. React Hooks must be called in the exact same order in every component render react-hooks/rules-of-hooks
14:9 error 'unusedVar' is assigned a value but never used @typescript-eslint/no-unused-vars
